<!-- action buttons (comment, pic, link, import) at the top of the bar -->
<!-- NOTE: does not use segment quite correctly atm, using (click) instead of (ionChange) on segment -->
<ion-segment id="action-buttons" value="comment" color="secondary"
  [style.height]="actionDetailVisible ? '30%' : '99%'"
  >
  <ion-segment-button *ngFor='let item of items'
    color="primary" [disabled]="!canSend"
    (click)='handleActionBtnClick($event, item)'
    [value]="item.text"
    >
    <div *ngIf='item.type === "button" && (gib !== "gib" || item.allowPrimitive)' color="primary">
      <ion-icon *ngFor="let iconName of item?.icons" slot="start" [name]="iconName"></ion-icon>
      <ion-spinner *ngIf="item.busy" name="circles" color="tertiary"></ion-spinner>
    </div>

    <div *ngIf='item.type === "inputfile" && (gib !== "gib" || item.allowPrimitive)' color="primary">
      <ion-icon *ngFor="let iconName of item?.icons" slot="start" [name]="iconName"></ion-icon>
      <ion-spinner *ngIf="item.busy" name="circles" color="tertiary"></ion-spinner>
    </div>
  </ion-segment-button>
</ion-segment>

<ng-template #sendBtnTemplate let-clickHandler="clickHandler">
    <ion-button class="detail-send-btn" color="primary"
      [disabled]="!canSend"
      (click)="clickHandler()">

      <ion-icon *ngIf="canSend" name="arrow-forward-outline"></ion-icon>
      <ion-spinner *ngIf="!canSend" name="circles" color="tertiary"></ion-spinner>

    </ion-button>
</ng-template>

<ng-template #sendIcons>
  <ion-icon *ngIf="canSend" name="arrow-forward-outline"></ion-icon>
  <ion-spinner *ngIf="!canSend" name="circles" color="tertiary"></ion-spinner>
</ng-template>

<!-- action detail -->
<div *ngIf="actionDetailVisible && gib !== 'gib'" id="action-detail">

  <!-- comment -->
  <div *ngIf="actionDetailMode === 'comment'" class="detail-container" >
    <ion-textarea #textareaComment id="textareaCommentId" class="detail-content"
      (ionChange)="handleCommentDetailChange($event)"
      (keypress)="handleCommentDetailInput($event)"
      autoGrow="true" autocomplete="true" autocapitalize="sentences"
      spellcheck="true" enterkeyhint="'send'" inputmode="'text'"
      [debounce]="debounceMs"
      color="primary"
      [disabled]="sending"
      (click)="handleTextAreaClick($event)"
      >
    </ion-textarea>
    <ng-template *ngTemplateOutlet="sendBtnTemplate;context: {clickHandler:send_AddComment.bind(this)}"></ng-template>
  </div>

  <!-- pics/files -->
  <div *ngIf="actionDetailMode === 'file'" class="detail-container">
    <div class="detail-content file-detail-content">
      <!-- thumbnails -->
      <ion-list id="thumbnails">
        <ion-item *ngFor="let candidate of resCreatePicCandidates;trackBy: trackByPicSrc"
          class="thumbnail-item thumbnail-like">
          <ion-thumbnail>
            <img [src]='candidate.picSrc'/>
          </ion-thumbnail>
          <ion-badge>
            <ion-button (click)="cancelPic(candidate)" [disabled]="sending" color="danger">
              <ion-icon name="close-outline"></ion-icon>
            </ion-button>
          </ion-badge>
        </ion-item>
      </ion-list>
      <!-- add from file btn -->
      <ion-button class="thumbnail-btn thumbnail-like" (click)='inputFile.click()'
        [disabled]="sending" slot="icon-only" size="small">
        <ion-icon name="image-outline"></ion-icon>
        <ion-badge slot="end">+</ion-badge>
        <input #inputFile type="file" hidden (change)="handleAddFileCamClick($event, 'file')" accept="image/*" multiple/>
      </ion-button>
      <!-- add from camera btn -->
      <ion-button *ngIf="platform !== 'android'" class="thumbnail-btn thumbnail-like" (click)='inputFile_Cam.click()'
        [disabled]="sending" slot="icon-only" size="small">
        <ion-icon name="camera-outline"></ion-icon>
        <ion-badge slot="end">+</ion-badge>
        <input #inputFile_Cam type="file" hidden (change)="handleAddFileCamClick($event, 'camera')" accept="image/*" capture/>
      </ion-button>
      <!-- android just don't work...use the web for tabs anyway... -->
      <!-- <ion-button *ngIf="platform === 'android'" class="thumbnail-btn thumbnail-like" (click)='inputFile_Cam.click()'
        [disabled]="sending" slot="icon-only" size="small">
        <ion-icon name="camera-outline"></ion-icon>
        <ion-badge slot="end">+*</ion-badge>
        <input #inputFile_Cam type="file" (change)="handleAddFileCamClick($event, 'camera')" capture/>
      </ion-button> -->
    </div>
    <!-- send btn -->
    <ng-template *ngTemplateOutlet="sendBtnTemplate;context: {clickHandler:send_AddPics.bind(this)}"></ng-template>
  </div>

  <!-- link -->
  <div *ngIf="actionDetailMode === 'link'" class="detail-container" >
    <ion-textarea #textareaLink id="inputLinkId" class="detail-content"
      (ionChange)="handleLinkDetailChange($event)"
      (keypress)="handleLinkDetailInput($event)"
      autoGrow="true" autocomplete="true" autocapitalize="sentences"
      spellcheck="true" enterkeyhint="'send'" inputmode="'text'"
      [debounce]="debounceMs"
      (click)="handleTextAreaClick($event)"
      [color]="linkTextIsValid ? 'primary' : 'danger'"
      [disabled]="sending"
      >
    </ion-textarea>
    <!-- send btn -->
    <ng-template *ngTemplateOutlet="sendBtnTemplate;context: {clickHandler:send_AddLink.bind(this)}"></ng-template>
  </div>

  <!-- import -->
  <div *ngIf="actionDetailMode === 'import'" class="detail-container" [disabled]="sending">
        <ion-button (click)='inputFileImport.click()' [disabled]="sending">
          <ion-icon name="document-outline"></ion-icon>
          <input #inputFileImport type="file" hidden (change)="handleImportFileInputClick($event)" accept="application/json" multiple/>
        </ion-button>
        <ion-textarea #inputImport id="inputImportId" class="detail-content"
          (ionChange)="handleImportDetailChange($event)"
          [debounce]="debounceMs"
          placeholder="Paste in a local or outerspace addr, or import by file"
          spellcheck="false"
          autoGrow="false"
          (click)="handleTextAreaClick($event)"
          >
        </ion-textarea>
    <!-- send btn -->
    <ng-template *ngTemplateOutlet="sendBtnTemplate;context: {clickHandler:send_AddImport.bind(this)}"></ng-template>
  </div>

</div>

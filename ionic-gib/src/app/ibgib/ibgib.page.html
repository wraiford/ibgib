<ion-header translucent="true">

  <!-- top title bar with menu & title ibgib -->
  <ion-toolbar id="top-title-bar">
    <ion-buttons slot="start">
      <ion-menu-button slot="icon-only"></ion-menu-button>
      <ion-button *ngIf="showBackChevronBtn" class="back-btn" (click)="handleBackButtonClick()">
        <ion-icon name="chevron-back-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>

    <!-- atow, i am doing selective titles in ibgib-component-base.ts title property  -->
    <ion-title *ngIf='isTag' class='toolbar-title-yo'>
      <tag-view [addr]='item.addr'> </tag-view>
    </ion-title>
    <ion-title *ngIf='isPic' class='pic-title toolbar-title-yo'>
      <ion-thumbnail>
        <pic-view [addr]='item.addr' [isTitleOrJustSmall]='true' (click)="showFullscreenModal()" ></pic-view>
      </ion-thumbnail>
    </ion-title>
    <ion-title *ngIf='isComment' class='comment-title toolbar-title-yo' (click)="handleTitleClick()">
      <comment-view [addr]='item.addr' [isTitleOrJustSmall]='true'></comment-view>
    </ion-title>
    <ion-title *ngIf='isRoot' class='toolbar-title-yo'>
      <root-view [addr]='item.addr'> </root-view>
    </ion-title>
    <ion-title *ngIf='!isTag && !isPic && !isComment && !isRoot' class='toolbar-title-yo'>
      {{ title }}
    </ion-title>
  </ion-toolbar>

  <!-- ibgib context buttons -->
  <ion-toolbar>
    <ion-buttons id="context-btns" slot="end">

      <!-- local refresh -->
      <ion-button *ngIf="gib !== 'gib'" [disabled]="refreshing" [ngClass]="{'active-btn':!paused}" class="toolbar-title-btn" (click)="handleRefreshClick()">
        <ion-icon *ngIf="!refreshing" name="refresh"></ion-icon>
        <ion-spinner *ngIf="refreshing" name="bubbles" color="tertiary"></ion-spinner>
        <ion-badge *ngIf="tjpUpdatesAvailableCount_Local" color="primary" slot="end">
          {{ tjpUpdatesAvailableCount_Local }}
        </ion-badge>
      </ion-button>

      <!-- share -->
      <ion-button *ngIf="ibGib" class="toolbar-title-btn" (click)="handleShareClick()">
        <ion-icon name="share-social-outline" ios="share-outline"></ion-icon>
      </ion-button>

      <!-- update pic -->
      <ion-button *ngIf="item?.type === 'pic'" class="toolbar-title-btn" [disabled]="syncing || refreshing"
        (click)="handleUpdatePicClick()">
        <ion-icon name="camera-reverse-outline"></ion-icon>
        <ion-spinner *ngIf="updatingPic" name="circles" color="tertiary"></ion-spinner>
      </ion-button>

      <!-- edit comment -->
      <ion-button *ngIf="item?.type === 'comment'" class="toolbar-title-btn" [disabled]="syncing || refreshing"
        (click)="handleUpdateCommentClick()">
        <ion-icon name="pencil-outline"></ion-icon>
        <ion-spinner *ngIf="updatingComment" name="circles" color="tertiary"></ion-spinner>
      </ion-button>

      <!-- download pic -->
      <ion-button *ngIf="item?.type === 'pic' && (ios || android)" class="toolbar-title-btn"
        [disabled]="syncing || refreshing" (click)="handleDownloadPicClick()">
        <ion-icon name="download-outline"></ion-icon>
        <ion-icon name="image-outline"></ion-icon>
        <ion-spinner *ngIf="downloadingPic" name="circles" color="tertiary"></ion-spinner>
      </ion-button>
      <a *ngIf="item?.type === 'pic' && web" [href]="item.picSrc"
        [download]="'Downloads/' + (item?.filenameWithExt || 'item.binHash.png')">
        <ion-button [disabled]="syncing || refreshing" class="toolbar-title-btn">
          <ion-icon name="download-outline"></ion-icon>
          <ion-icon name="image-outline"></ion-icon>
        </ion-button>
      </a>

      <!-- apps -->
      <ion-button *ngIf="ibGib" [disabled]="!ibGib" class="toolbar-title-btn" (click)="handleAppClick()"
        [ngClass]="{'active-btn':appBarIsVisible}">
        <ion-icon name="apps-outline"></ion-icon>
      </ion-button>

      <!-- robbot -->
      <ion-button *ngIf="ibGib" [disabled]="refreshing" class="toolbar-title-btn" (click)="handleRobbotClick()"
        [ngClass]="{'active-btn':robbotBarIsVisible}">
        <ion-icon name="body-outline"></ion-icon>
      </ion-button>

      <!-- space sparkles -->
      <ion-button *ngIf="tjp" [disabled]="syncing || refreshing" [ngClass]="{'active-btn': autosync}" class="toolbar-title-btn" (click)="handleSpaceClick()">
        <ion-icon name="sparkles-outline"></ion-icon>
      </ion-button>

      <!-- rocket sync -->
      <ion-button *ngIf="tjp" [disabled]="syncing || refreshing" class="toolbar-title-btn" (click)="handleSyncClick()">
        <ion-badge *ngIf="syncErrored" color="danger" slot="start">
          <ion-icon name="alert-circle-outline"></ion-icon>
        </ion-badge>
        <ion-badge *ngIf="syncDecrypting" color="dark" slot="start">
          <ion-icon name="prism-outline"></ion-icon>
        </ion-badge>
        <ion-badge *ngIf="syncBuildingGraph" color="light" slot="start">
          <ion-icon name="football-outline"></ion-icon>
        </ion-badge>
        <ion-badge *ngIf="syncStatusUpdates > 0" color="secondary" slot="end">
          {{ syncStatusUpdates }}
        </ion-badge>
        <ion-badge *ngIf="syncSucceeded" color="success" slot="start">
          <ion-icon name="checkmark-outline"></ion-icon>
        </ion-badge>
        <ion-label>
          <ion-icon name="rocket-outline"></ion-icon>
          <ion-icon *ngIf="!syncing" name="sync-outline"></ion-icon>
        </ion-label>
        <ion-spinner *ngIf="syncing" name="circles" color="tertiary"></ion-spinner>
        <ion-badge *ngIf="tjpUpdatesAvailableCount_Store" color="primary" slot="end">
          {{ tjpUpdatesAvailableCount_Store }}
        </ion-badge>
      </ion-button>

      <!-- tag -->
      <ion-button [disabled]="syncing || refreshing || paused || tagging" class="toolbar-title-btn" (click)="handleTagClick($event)">
        <ion-icon name="pricetag-outline"></ion-icon>
        <ion-spinner *ngIf="tagging" name="bubbles" color="tertiary"></ion-spinner>
      </ion-button>

      <!-- export -->
      <ion-button class="toolbar-title-btn" (click)="handleExportClick()" [disabled]="refreshing" slot="icon-only" size="small">
        <ion-icon *ngIf="!preparingExport" name="code-download-outline"></ion-icon>
        <a id="export-ibgib-anchor" style="display:none"></a>
        <ion-spinner *ngIf="preparingExport" name="bubbles" color="tertiary"></ion-spinner>
      </ion-button>

      <!-- information (show raw json) -->
      <ion-button [disabled]="refreshing" class="toolbar-title-btn" (click)="handleInfoClick($event)">
        <ion-icon name="information-outline"></ion-icon>
      </ion-button>

    </ion-buttons>
  </ion-toolbar>

</ion-header>

<ion-content #ibgibPageContent [fullscreen]="false" [forceOverscroll]="false">

  <ion-text *ngIf="statusText" color="primary">{{statusText}}</ion-text>
  <ion-skeleton-text *ngIf="!item?.ibGib || refreshing" animated
    style="width: 100%;height:100%;border-radius:5%;opacity:0.4;" color="primary">
  </ion-skeleton-text>

  <!-- main body -->
  <div id="container" *ngIf="item?.ibGib" [style.border-color]="debugBorderColor"
    [style.border-width]="debugBorderWidth" [style.border-style]="debugBorderStyle">

    <ib-app-bar #appBar [addr]='addr'
      [hidden]="!appBarIsVisible"
      (appSelected)="handleAppSelected($event)"></ib-app-bar>
    <ib-robbot-bar #robbotBar
      [hidden]="!robbotBarIsVisible"
      [addr]='addr' [selectedRobbotAddr]="selectedRobbotAddr"
      (robbotSelected)="handleRobbotSelected($event)"></ib-robbot-bar>

    <ng-container [ngSwitch]="activeApp?.data.classname">
      <ib-chat-app *ngSwitchCase="'ChatApp_V1'" [addr]="addr" [activeApp]="activeAppAny"></ib-chat-app>
      <ib-raw-app *ngSwitchCase="'RawApp_V1'" [addr]="addr" [activeApp]="activeAppAny"></ib-raw-app>
      <ib-todo-app *ngSwitchCase="'TodoApp_V1'" [addr]="addr" [activeApp]="activeAppAny"></ib-todo-app>
      <ib-chat-app *ngSwitchDefault [addr]="addr"></ib-chat-app>
      <!-- <p *ngSwitchDefault>default</p> -->
    </ng-container>




    <!-- using ngIf/then/else... -->
    <!-- <ng-container *ngIf="activeApp?.data.classname === 'ChatApp_V1';then chatApp; else defaultApp">
    </ng-container>
    <ng-template #chatApp>
      <ib-chat-app [addr]="addr"></ib-chat-app>
    </ng-template>
    <ng-template #defaultApp>
      <ib-chat-app [addr]="addr"></ib-chat-app>
    </ng-template> -->

    <!-- <tag-list *ngIf='isTags' [addr]='addr' [ibGib_Context]='ibGib' (scroll)="scrollSubject.next($event)">
    </tag-list> -->
    <!-- <root-list *ngIf='isRoots' [addr]='addr' [ibGib_Context]='ibGib' (scroll)="scrollSubject.next($event)">
    </root-list> -->
    <!-- <chat-view #chatView *ngIf='!(isTags || isRoots) && !showHeart' [addr]='addr' [ibGib_Context]='ibGib'
      (scroll)="scrollSubject.next($event)" (itemsAdded)="handleChatItemsAdded()">
    </chat-view> -->

    <!-- show pics in svg view -->
    <!-- everything else linear chat -->
    <!-- <div id="heart-div" *ngIf='!(isTags || isRoots) && showHeart'>
      <svg-view #ibgibpageSvgView [addr]='addr' [ibGib_Context]='ibGib'>
      </svg-view>
      <chat-view #chatViewHeart [addr]='addr' [ibGib_Context]='ibGib' [rel8nNames]="chatViewRel8nNamesNoPics"
        (scroll)="scrollSubject.next($event)" (itemsAdded)="handleChatItemsAdded()">
      </chat-view>
    </div> -->

    <ion-modal [isOpen]="showModal_PromptForTag">
      <ng-template>
        <ion-content id="select-tag-content">
          <ion-title id="select-tag-title">Select tag...</ion-title>
          <ion-buttons id="select-tag-btns">
            <ion-button *ngFor="let tag of tagIbGibs" class="select-tag-btn" (click)="handleSelectTag_ExistingTag(tag)"
              color="primary">
              <ion-icon [name]="tag.data?.icon || 'help-outline'"></ion-icon>
              <ion-label>{{ tag.data?.text || '[tag text missing?]' }} </ion-label>
            </ion-button>
          </ion-buttons>
          <ion-buttons id="select-tag-btns-special">
            <ion-button (click)="handleSelectTag_New()" color="secondary">
              <ion-icon name="add-outline"></ion-icon>
              <ion-label>new tag...</ion-label>
            </ion-button>
            <ion-button (click)="handleSelectTag_Cancel()" color="danger">
              <ion-icon name="close-outline"></ion-icon>
              <ion-label>cancel</ion-label>
            </ion-button>
          </ion-buttons>
        </ion-content>
      </ng-template>
    </ion-modal>

  </div>

</ion-content>

<!-- <ion-modal #bottomSheet id="bottom-sheet-modal"
  [isOpen]="true"
  [breakpoints]="[0.1, 1]"
  [initialBreakpoint]="1"
  [backdropBreakpoint]="1"
  canDismiss="false"
>
  <ng-template>
    <ion-content>
      <action-bar #actionBar [addr]='addr' [ibGib_Context]='ibGib'></action-bar>
    </ion-content>
  </ng-template>
</ion-modal> -->
<!-- <ion-footer [style.height]="actionBar.actionDetailVisible ? '33%' : '6%'"> -->
<ion-footer>
  <action-bar #actionBar [addr]='addr' [ibGib_Context]='ibGib'></action-bar>
</ion-footer>
